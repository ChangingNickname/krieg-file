<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Личное Дело — 7th SNP FEL 6914 Graga</title>
  <style>
    /* ===== Общий фон страницы (стол) ===== */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Cormorant Garamond", "Times New Roman", serif;
      background: radial-gradient(circle at top, #7b6b54 0%, #403628 50%, #221b14 100%);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    body {
      color: #2b2116;
    }

    /* Лёгкая виньетка */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.7) 100%);
      z-index: 0;
    }

    /* ===== Папка / Личное дело ===== */
    .folder {
      position: relative;
      z-index: 1;
      width: 1000px;      /* фиксированная ширина */
      max-width: 1000px;  /* фиксированная ширина */
      min-height: 540px;
      background: #f6f0e4;
      background-image:
        linear-gradient(rgba(255,255,255,0.2), rgba(255,255,255,0)),
        repeating-linear-gradient(
          0deg,
          rgba(0,0,0,0.02),
          rgba(0,0,0,0.02) 1px,
          transparent 1px,
          transparent 3px
        );
      border-radius: 6px 6px 4px 4px;
      box-shadow:
        0 18px 35px rgba(0,0,0,0.6),
        0 0 0 2px rgba(45,35,22,0.5);
      padding: 22px 26px 26px 26px;
      box-sizing: border-box;
      overflow: hidden;
    }

    /* Хвост папки сверху */
    .folder::before {
      content: "";
      position: absolute;
      top: -16px;
      left: 40px;
      width: 160px;
      height: 22px;
      background: #e0d2b7;
      border-radius: 4px 4px 0 0;
      box-shadow: 0 2px 3px rgba(0,0,0,0.4);
    }

    .folder-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      border-bottom: 1px solid rgba(0,0,0,0.15);
      padding-bottom: 6px;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .folder-title-main {
      font-weight: 700;
      font-size: 1.05rem;
    }

    .folder-title-sub {
      font-size: 0.75rem;
      opacity: 0.9;
    }

    .folder-header-right {
      text-align: right;
      font-size: 0.8rem;
      min-width: 340px; /* чуть шире справа */
    }

    /* Красный штамп "СЕКРЕТНО" */
    .stamp-secret {
      position: absolute;
      top: 40px;
      right: 40px;
      padding: 6px 18px;
      border: 2px solid rgba(151, 34, 34, 0.9);
      color: rgba(151, 34, 34, 0.95);
      font-weight: 700;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.25em;
      transform: rotate(-12deg);
      opacity: 0.8;
      background: transparent;
      mix-blend-mode: multiply;
    }

    /* Круглый штамп Муниторум */
    .stamp-round {
      position: absolute;
      left: 40px;
      bottom: 40px;
      width: 130px;
      height: 130px;
      border-radius: 50%;
      border: 2px solid rgba(63,59,50,0.7);
      color: rgba(63,59,50,0.85);
      font-size: 0.55rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      display: flex;
      align-items: center;
      justify-content: center;
      transform: rotate(-5deg);
      opacity: 0.6;
      mix-blend-mode: multiply;
    }

    .stamp-round span {
      text-align: center;
      padding: 0 6px;
    }

    /* ===== Внутреннее разделение: закладки и контент ===== */
    .folder-inner {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 18px;
      margin-top: 8px;
    }

    /* Полоса-«корешок» слева */
    .spine {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 38px;
      background: linear-gradient(90deg, #d8c8a7, #e5d5b6 40%, #f6f0e4 100%);
      box-shadow:
        inset -2px 0 5px rgba(0,0,0,0.25),
        4px 0 5px rgba(0,0,0,0.25);
      z-index: -1;
    }

    /* ===== Закладки разделов ===== */
    .tabs {
      position: relative;
      padding-top: 10px;
      padding-bottom: 10px;
    }

    .tab-label {
      position: relative;
      display: block;
      width: 100%;
      margin-bottom: 8px;
      padding: 8px 12px 8px 18px;
      background: #e7d6b8;
      border-radius: 4px 0 0 4px;
      box-shadow:
        inset 0 0 0 1px rgba(0,0,0,0.15),
        2px 2px 3px rgba(0,0,0,0.25);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      cursor: pointer;
      border: none;
      text-align: left;
      color: #3c2e1e;
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
    }

    .tab-label::before {
      content: "";
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 60%;
      background: rgba(0,0,0,0.25);
      border-radius: 2px;
    }

    .tab-label:hover {
      background: #f1dfbc;
      transform: translateX(2px);
      box-shadow:
        inset 0 0 0 1px rgba(0,0,0,0.18),
        3px 3px 4px rgba(0,0,0,0.25);
    }

    .tab-label.active {
      background: #f8ecd1;
      transform: translateX(4px);
      box-shadow:
        inset 0 0 0 1px rgba(0,0,0,0.25),
        4px 4px 5px rgba(0,0,0,0.35);
      font-weight: 600;
    }

    /* ===== Контент разделов ===== */
    .sections {
      position: relative;
      padding: 8px 12px 12px 18px;
      border-left: 2px solid rgba(0,0,0,0.12);
      height: 420px;      /* фиксированная видимая высота "страницы" */
      overflow: hidden;   /* никаких скроллов */
    }

    .section-content {
      display: none;
      height: 100%;
      animation: fadeIn 0.3s ease-out;
    }

    .section-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .section-title {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      font-weight: 700;
    }

    .section-meta {
      font-size: 0.75rem;
      opacity: 0.8;
    }

    .section-divider-line {
      height: 1px;
      background: linear-gradient(to right, rgba(0,0,0,0.2), transparent);
      margin-bottom: 8px;
    }

    .typewriter {
      white-space: pre-line;
      font-family: "Special Elite", "Courier New", monospace;
      font-size: 0.92rem;
      line-height: 1.4;
      height: calc(100% - 70px); /* оставляем место под "штрих-код" и уголок */
      overflow: hidden;
    }

    /* Подчёркивания для полей */
    .field-line {
      display: inline-block;
      min-width: 130px;
      border-bottom: 1px dotted rgba(0,0,0,0.5);
      margin: 0 4px;
    }

    /* Небольшая "штрих-кодовая" зона внизу */
    .barcode {
      margin-top: 6px;
      font-size: 0.7rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: 0.85;
    }

    .barcode-pattern {
      height: 22px;
      display: flex;
      gap: 2px;
    }

    .barcode-pattern span {
      display: block;
      width: 2px;
      background: rgba(0,0,0,0.7);
      transform: scaleY(0.5 + (var(--h) * 0.5));
    }

    .barcode-text {
      text-transform: uppercase;
      letter-spacing: 0.15em;
    }

    /* ===== Кнопка-уголок "следующая страница" ===== */
/* ===== Кнопки-уголки "страницы" + индикатор ===== */
    .page-corner {
    position: absolute;
    bottom: 0;
    width: 60px;
    height: 60px;
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    outline: none;
    display: none; /* показываем через JS */
    }

    /* Уголок "ДАЛЕЕ" (справа) */
    .page-corner.next {
    right: 0;
    }

    .page-corner.next::before {
    content: "";
    position: absolute;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    background:
        linear-gradient(
        135deg,
        transparent 0,
        transparent 49%,
        rgba(223,210,180,0.98) 50%,
        #e0d2b7 100%
        );
    box-shadow: -2px -2px 3px rgba(0,0,0,0.35);
    }

    .page-corner.next::after {
    content: "ДАЛЕЕ";
    position: absolute;
    right: 6px;
    bottom: 10px;
    font-family: "Special Elite", "Courier New", monospace;
    font-size: 0.55rem;
    letter-spacing: 0.16em;
    transform: rotate(-45deg);
    color: rgba(90,70,50,0.9);
    }

    /* Уголок "НАЗАД" (слева) */
    .page-corner.prev {
    left: 0;
    }

    .page-corner.prev::before {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    background:
        linear-gradient(
        225deg,
        transparent 0,
        transparent 49%,
        rgba(223,210,180,0.98) 50%,
        #e0d2b7 100%
        );
    box-shadow: 2px -2px 3px rgba(0,0,0,0.35);
    }

    .page-corner.prev::after {
    content: "НАЗАД";
    position: absolute;
    left: 6px;
    bottom: 10px;
    font-family: "Special Elite", "Courier New", monospace;
    font-size: 0.55rem;
    letter-spacing: 0.16em;
    transform: rotate(45deg);
    color: rgba(90,70,50,0.9);
    }

    .page-corner:hover::before {
    filter: brightness(1.05);
    }

    /* Индикатор номера страницы */
    .page-indicator {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-family: "Special Elite", "Courier New", monospace;
    font-size: 0.7rem;
    letter-spacing: 0.16em;
    color: rgba(60,45,30,0.9);
    opacity: 0.85;
    display: none; /* показываем через JS */
    }


    @media (max-width: 900px) {
      .folder-inner {
        grid-template-columns: 130px 1fr;
      }
    }

    @media (max-width: 700px) {
      .folder {
        padding: 18px 16px 22px 16px;
        width: 100%;
        max-width: 100%;
      }
      .folder-inner {
        grid-template-columns: 1fr;
      }
      .tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .tab-label {
        border-radius: 4px;
        width: auto;
        padding-right: 18px;
      }
      .sections {
        border-left: none;
        border-top: 2px solid rgba(0,0,0,0.12);
        margin-top: 8px;
        padding-left: 4px;
      }
      .stamp-round {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="spine"></div>

  <div class="folder">
    <div class="folder-header">
      <div>
        <div class="folder-title-main">ИМПЕРИУМ ЧЕЛОВЕЧЕСТВА</div>
        <div class="folder-title-sub">ДЕПАРТАМЕНТО МУНИТОРУМ · ЛИЧНОЕ ДЕЛО ВОЕННОСЛУЖАЩЕГО</div>
      </div>
      <div class="folder-header-right">
        <div>7-й Корпус Смерти Крига</div>
        <div>Имя: ОТСУТСТВУЕТ</div>
        <div>№ Досье: KR-7-8787-</div>
      </div>
    </div>

    <div class="stamp-secret">СЕКРЕТНО</div>
    <div class="stamp-round">
      <span>DEPARTAMENTO MUNITORUM · SEGMENTUM OBSCURUS · VALIDATED</span>
    </div>

    <div class="folder-inner">
      <!-- Закладки -->
      <aside class="tabs">
        <button class="tab-label active" data-section="anketa">Профиль</button>
        <button class="tab-label" data-section="service">Учетно-послужная карта</button>
        <button class="tab-label" data-section="medical">Медицинская карта</button>
        <button class="tab-label" data-section="bio">Биография</button>
      </aside>

      <!-- Контент разделов -->
      <section class="sections">
        <!-- Анкета -->
        <div class="section-content active" id="section-anketa">
          <div class="section-header">
            <div class="section-title">Профиль</div>
            <div class="section-meta">Форма 17-А · Первичное заполнение</div>
          </div>
          <div class="section-divider-line"></div>

          <div class="typewriter">
Номер/имя: 8787<span class="field-line"></span>
Звание: Обер-Ефрейтор<span class="field-line"></span>
Должность: Квартирмейстер | Знаменосец<span class="field-line"></span>
Возраст: 22 года<span class="field-line"></span>
Место рождения: Мир-Смерти Криг<span class="field-line"></span>
Медали: Печать Чистоты, "Простой Орёл", Серебрянный Череп, "Окопный Штурмовик"<span class="field-line" style="min-width:120px;"></span>
<!-- Грамоты: Мунисторума, РПКшера, Знаменосца, за отбитие Томской Михайловской рощи, Модробоя<span class="field-line" style="min-width:120px;"></span> -->
Особые приметы: Газовая маска постоянно впадывает вглубь лица.
<span class="field-line" style="min-width:300px;"></span>

<!-- Документ составлен квартирмейстером: <span class="field-line" style="min-width:180px;"></span> -->
Дата составления: <span class="field-line" style="min-width:120px;"></span>

          </div>

          <div class="barcode">
            <div class="barcode-pattern">
              <span style="--h:0.2"></span>
              <span style="--h:0.8"></span>
              <span style="--h:0.4"></span>
              <span style="--h:0.9"></span>
              <span style="--h:0.5"></span>
              <span style="--h:0.7"></span>
              <span style="--h:0.3"></span>
              <span style="--h:0.6"></span>
              <span style="--h:0.9"></span>
              <span style="--h:0.4"></span>
            </div>
            <div class="barcode-text">7TH-FAH-O-EFR-8787</div>
          </div>
        </div>

        <!-- Учетно-послужная карта -->
        <div class="section-content" id="section-service">
          <div class="section-header">
            <div class="section-title">Учетно-послужная карта</div>
            <div class="section-meta">Форма 42-Б · Служебный путь</div>
          </div>
          <div class="section-divider-line"></div>

          <div class="typewriter">
Возраст зачисления в новобранцы: 14 лет<span class="field-line"></span>
Возраст зачисления в шутце: 18 лет<span class="field-line"></span>
Место призыва: Гарнизонный призывной пункт №17, Подземный Улей В-27, Мир-Смерти Криг<span class="field-line" style="min-width:220px;"></span>

СЛУЖЕБНЫЕ ЗАПИСИ:

[1]  Дата: 12.10.М41
     Должность / роль: Шутце, Солдат 7-го Корпуса Смерти Крига
     Был частью пополнения рядового состава 7-го Корпуса Смерти Крига, прибывшего из Подземного Улья В-27.


[2]  Дата: 13.10.М41
     Должность / роль: Шутце, Квартирмейстер 7-го Корпуса Смерти Крига
     Был принят в ряды квартирмейстеров после экзаминации и официального принятия Обер-Фельдфебелем 2650, старшим квартирмейстером 7-го корпуса.

[3]  Дата: 14.10.М41
     Должность / роль: Шутце, Квартирмейстер 7-го Корпуса Смерти Крига
     Участвовал в защите корабля от аномальных сил, в результате чего был повышен в звании Обер-Фельдфебелем 2650 до Обер-Шутце.

[4]  Дата: 15.10.М41
     Должность / роль: Обер-Шутце, Квартирмейстер 7-го Корпуса Смерти Крига
     Участвовал в первой операции, начавшую кампанию на Гераль-Примусе, по захвату и удержанию плацдарма на поверхности планеты.

[5]  Дата: 16.10.М41
     Должность / роль: Обер-Шутце, Квартирмейстер 7-го Корпуса Смерти Крига
     Участвовал в обороне аванпоста от архиврага. За доблесть в бою, приказом, Гауптмана 1389 получил печать Чистоты, медали "Серебрянный Череп" и "Просто Орёл".
    
[6]  Дата: 26.10.М41
     Должность / роль: Обер-Шутце, Квартирмейстер 7-го Корпуса Смерти Крига
     Участвовал в битве против сил еретиков после раскрытия раздведывательной миссии, в результате чего, по приказу Гауптмана 1389, был повышен в звании Геверхарта и получил медаль "Окопный Штурмовик".

[6]  Дата: 30.10.М41
     Должность / роль: Геверхарт, Квартирмейстер 7-го Корпуса Смерти Крига
     Участвовал в бою во время марша-прорыва к системе ПКО, за что, по приказу Гауптмана 1389, был повышен до звания Ефрейтора.

[7]  Дата: 02.11.М41
     Должность / роль: Ефрейтор, Квартирмейстер 7-го Корпуса Смерти Крига
     Приказом Гауптмана 1389 был назначен на должность Знаменосца корпуса.

[8]  Дата: 03.11.М41
     Должность / роль: Ефрейтор, Квартирмейстер, Знаменосец 7-го Корпуса Смерти Крига
     Участвовал в операции по захвату ПКО. Сопровождал Гауптмана 1389 в ходе рейда, как ведущий знаменосец.

[9] Дата: 04.11.М41
     Должность / роль: Ефрейтор, Квартирмейстер, Знаменосец 7-го Корпуса Смерти Крига
     Как знаменосец, открывает церемонию похорон Гауптмана 1389, погибшего в бою при штурме ПКО.
    
[10] Дата: 08.11.М41
     Должность / роль: Ефрейтор, Квартирмейстер, Знаменосец 7-го Корпуса Смерти Крига
     Под руководством Гауптмана 1917, вывел большинство солдат на эвакуацию с поверхности Гераль-Примуса.

[11] Дата: 18.11.М41
     Должность / роль: Ефрейтор, Квартирмейстер, Знаменосец 7-го Корпуса Смерти Крига
     Занимался контролью перевоза снабжения при высадке на Урл Фастинг, во время начала кампании на Моосе.

[11] Дата: 21.11.М41
     Должность / роль: Ефрейтор, Квартирмейстер, Знаменосец 7-го Корпуса Смерти Крига
     Приказом Обер-Лейтенанта 1388, повышен до звания Обер-Ефрейтора за отличную службу в ходе кампании на Гераль-Примусе и текущей кампании на Моосе.






Награды и поощрения:
 — ________________________________________________________________
 — ________________________________________________________________

Взыскания и дисциплинарные меры:
 — ________________________________________________________________
 — ________________________________________________________________
          </div>

          <div class="barcode">
            <div class="barcode-pattern">
              <span style="--h:0.9"></span>
              <span style="--h:0.4"></span>
              <span style="--h:0.7"></span>
              <span style="--h:0.2"></span>
              <span style="--h:0.8"></span>
              <span style="--h:0.5"></span>
              <span style="--h:0.3"></span>
            </div>
            <!-- <div class="barcode-text">FORM-42B-SERVICE-RECORD</div> -->
          </div>
        </div>

        <!-- Медицинская карта -->
        <div class="section-content" id="section-medical">
          <div class="section-header">
            <div class="section-title">Медицинская карта</div>
            <div class="section-meta">Форма М-9 · Хирургениум</div>
          </div>
          <div class="section-divider-line"></div>

          <div class="typewriter">
Общий статус годности: <span class="field-line" style="min-width:200px;"></span>

Рост: <span class="field-line"></span>    Вес: <span class="field-line"></span>
Слух: <span class="field-line" style="min-width:120px;"></span>    Зрение: <span class="field-line" style="min-width:120px;"></span>

Перенесённые ранения и повреждения:
 — ________________________________________________________________
 — ________________________________________________________________
 — ________________________________________________________________

Импланты и протезы:
 — ________________________________________________________________
 — ________________________________________________________________

Психическое состояние:
 — ________________________________________________________________
 — ________________________________________________________________

Рекомендации мед.персонала:
 — ________________________________________________________________
 — ________________________________________________________________

Осмотр провёл(а): <span class="field-line" style="min-width:180px;"></span>
Дата осмотра: <span class="field-line" style="min-width:120px;"></span>
          </div>

          <div class="barcode">
            <div class="barcode-pattern">
              <span style="--h:0.6"></span>
              <span style="--h:0.3"></span>
              <span style="--h:0.8"></span>
              <span style="--h:0.4"></span>
              <span style="--h:0.9"></span>
            </div>
            <!-- <div class="barcode-text">MEDICA-FORM-M9</div> -->
          </div>
        </div>

        <!-- Биография -->
        <div class="section-content" id="section-bio">
          <div class="section-header">
            <div class="section-title">Биография</div>
            <div class="section-meta">Предвоенный период и служба</div>
          </div>
          <div class="section-divider-line"></div>

          <div class="typewriter">
КРАТКАЯ ПРЕДЫСТОРИЯ (ДО ПРИЗЫВА):

____________________________________________________________________
____________________________________________________________________
____________________________________________________________________
____________________________________________________________________
 
СЛУЖЕБНЫЕ ОСОБЕННОСТИ И ХАРАКТЕР:

____________________________________________________________________
____________________________________________________________________
____________________________________________________________________

ЛИЧНЫЕ НАБЛЮДЕНИЯ КВАРТИРМЕЙСТЕРА / КОМАНДОВАНИЯ:

____________________________________________________________________
____________________________________________________________________
____________________________________________________________________

Подпись офицера, утвердившего биографию:
<span class="field-line" style="min-width:260px;"></span>

Дата утверждения:
<span class="field-line" style="min-width:130px;"></span>
          </div>

          <div class="barcode">
            <div class="barcode-pattern">
              <span style="--h:0.5"></span>
              <span style="--h:0.7"></span>
              <span style="--h:0.2"></span>
              <span style="--h:0.9"></span>
              <span style="--h:0.4"></span>
              <span style="--h:0.6"></span>
            </div>
            <!-- <div class="barcode-text">BIOGRAPHIA-MILITARIS</div> -->
          </div>
        </div>

        <!-- Уголок "следующая страница" -->
        <!-- Уголки страниц + индикатор -->
        <button class="page-corner prev" id="pagePrev" aria-label="Предыдущая страница"></button>
        <button class="page-corner next" id="pageNext" aria-label="Следующая страница"></button>
        <div class="page-indicator" id="pageIndicator"></div>

      </section>
    </div>
  </div>

    <script>
    // ===== ПОСТРАНИЧНЫЙ ВЫВОД С РАЗБИВКОЙ ПО АБЗАЦАМ + ПРОГРЕСС =====

    const tabs = document.querySelectorAll(".tab-label");
    const sections = document.querySelectorAll(".section-content");
    const pagePrev = document.getElementById("pagePrev");
    const pageNext = document.getElementById("pageNext");
    const pageIndicator = document.getElementById("pageIndicator");

    const typeSpeed = 18;     // скорость печати
    const typeJitter = 25;    // небольшой рандом
    const pageSize = 700;     // целевой размер "страницы" в символах

    let currentSection = null;
    let typingTimer = null;
    let currentPageText = "";
    let currentCharIndex = 0;

    // section -> массив страниц ["...", "...", ...]
    const pagesBySection = new WeakMap();

    // section -> Set(pageIndex) (страницы, которые уже один раз полностью показали)
    const seenPages = new WeakMap();

    // section -> Map(pageIndex -> maxCharsTyped)
    const progressPages = new WeakMap();

    function getSeenSet(section) {
        let set = seenPages.get(section);
        if (!set) {
        set = new Set();
        seenPages.set(section, set);
        }
        return set;
    }

    function markPageSeen(section, pageIndex) {
        const set = getSeenSet(section);
        set.add(pageIndex);

        let m = progressPages.get(section);
        if (!m) {
        m = new Map();
        progressPages.set(section, m);
        }
        m.set(pageIndex, currentPageText.length);
    }

    function isPageSeen(section, pageIndex) {
        const set = seenPages.get(section);
        return set ? set.has(pageIndex) : false;
    }

    function getProgressMap(section) {
        let m = progressPages.get(section);
        if (!m) {
        m = new Map();
        progressPages.set(section, m);
        }
        return m;
    }

    // Аккуратно режем текст на страницы по абзацам (разделитель: пустая строка)
    function buildPagesForSection(section) {
        const tw = section.querySelector(".typewriter");
        if (!tw) return;

        const full = (tw.dataset.fulltext || tw.textContent || "").replace(/\s+$/,"");
        tw.dataset.fulltext = full;

        // Разбиваем на блоки по пустым строкам
        const rawBlocks = full.split(/\n\s*\n/);
        const blocks = rawBlocks.map(b => b.trimEnd());

        const pages = [];
        let current = "";

        for (let i = 0; i < blocks.length; i++) {
        const block = blocks[i];
        if (block === "") continue;

        if (current === "") {
            // если сам блок очень длинный — крайний случай, режем его на куски по pageSize
            if (block.length > pageSize * 1.5) {
            let start = 0;
            while (start < block.length) {
                pages.push(block.slice(start, start + pageSize));
                start += pageSize;
            }
            current = "";
            } else {
            current = block;
            }
        } else {
            const candidate = current + "\n\n" + block;
            if (candidate.length > pageSize) {
            pages.push(current);
            // если блок сам по себе слишком длинный — режем его
            if (block.length > pageSize * 1.5) {
                let start = 0;
                while (start < block.length) {
                pages.push(block.slice(start, start + pageSize));
                start += pageSize;
                }
                current = "";
            } else {
                current = block;
            }
            } else {
            current = candidate;
            }
        }
        }

        if (current !== "") {
        pages.push(current);
        }

        if (pages.length === 0) {
        pages.push("");
        }

        pagesBySection.set(section, pages);
        section.dataset.totalPages = String(pages.length);
        if (!section.dataset.pageIndex) {
        section.dataset.pageIndex = "0";
        }
    }

    function getPages(section) {
        let pages = pagesBySection.get(section);
        if (!pages) {
        buildPagesForSection(section);
        pages = pagesBySection.get(section) || [""];
        }
        return pages;
    }

    function saveCurrentProgress() {
        if (!currentSection) return;
        const section = currentSection;
        const tw = section.querySelector(".typewriter");
        if (!tw) return;

        const pageIndex = parseInt(section.dataset.pageIndex || "0", 10);
        const visibleLen = tw.textContent.length;
        if (visibleLen <= 0) return;

        const m = getProgressMap(section);
        const prev = m.get(pageIndex) || 0;
        if (visibleLen > prev) {
        m.set(pageIndex, visibleLen);
        }
    }

    function startTypewriter(section, pageText, onComplete, startIndex = 0, presetText = "") {
        const tw = section.querySelector(".typewriter");
        if (!tw) return;

        if (typingTimer !== null) {
        clearTimeout(typingTimer);
        typingTimer = null;
        }

        currentSection = section;
        currentPageText = pageText;
        currentCharIndex = startIndex;
        tw.textContent = presetText;

        function step() {
        if (currentSection !== section) return; // раздел сменили

        if (currentCharIndex > currentPageText.length) {
            typingTimer = null;
            if (typeof onComplete === "function") onComplete();
            return;
        }

        tw.textContent = currentPageText.slice(0, currentCharIndex);
        currentCharIndex++;

        const delay = typeSpeed + Math.random() * typeJitter;
        typingTimer = setTimeout(step, delay);
        }

        step();
    }

    function updateNavButtons(totalPages, pageIndex, typing) {
        if (totalPages <= 1) {
        pageIndicator.style.display = "none";
        pagePrev.style.display = "none";
        pageNext.style.display = "none";
        return;
        }

        pageIndicator.style.display = "block";
        pageIndicator.textContent = `Стр. ${pageIndex + 1} / ${totalPages}`;

        // "НАЗАД"
        pagePrev.style.display = pageIndex === 0 ? "none" : "block";

        // "ДАЛЕЕ" (только если не последняя и страница уже допечатана)
        if (pageIndex === totalPages - 1) {
        pageNext.style.display = "none";
        } else {
        pageNext.style.display = typing ? "none" : "block";
        }
    }

    function updatePageUI(section) {
        const pages = getPages(section);
        const tw = section.querySelector(".typewriter");
        if (!tw) return;

        let pageIndex = parseInt(section.dataset.pageIndex || "0", 10);
        let totalPages = pages.length;

        if (pageIndex < 0) pageIndex = 0;
        if (pageIndex > totalPages - 1) pageIndex = totalPages - 1;
        section.dataset.pageIndex = String(pageIndex);
        section.dataset.totalPages = String(totalPages);

        const pageText = pages[pageIndex];

        const pageSeen = isPageSeen(section, pageIndex);
        const progMap = getProgressMap(section);
        let progress = progMap.get(pageIndex) || 0;
        if (progress > pageText.length) progress = pageText.length;

        // Страница уже один раз была полностью показана — сразу полный текст
        if (pageSeen) {
        if (typingTimer !== null) {
            clearTimeout(typingTimer);
            typingTimer = null;
        }
        currentSection = section;
        currentPageText = pageText;
        currentCharIndex = pageText.length;
        tw.textContent = pageText;

        updateNavButtons(totalPages, pageIndex, false);
        return;
        }

        // Есть частичный прогресс — продолжаем печатать с этого места
        if (progress > 0 && progress < pageText.length) {
        updateNavButtons(totalPages, pageIndex, true);

        const presetText = pageText.slice(0, progress);
        startTypewriter(
            section,
            pageText,
            () => {
            markPageSeen(section, pageIndex);
            updateNavButtons(totalPages, pageIndex, false);
            },
            progress,
            presetText
        );
        } else if (progress >= pageText.length && pageText.length > 0) {
        // На всякий случай: прогресс полностью закрывает страницу
        markPageSeen(section, pageIndex);
        tw.textContent = pageText;
        updateNavButtons(totalPages, pageIndex, false);
        } else {
        // Прогресса нет — печать с нуля
        updateNavButtons(totalPages, pageIndex, true);

        startTypewriter(
            section,
            pageText,
            () => {
            markPageSeen(section, pageIndex);
            updateNavButtons(totalPages, pageIndex, false);
            },
            0,
            ""
        );
        }
    }

    function activateSectionById(shortId) {
        const targetId = "section-" + shortId;
        const sec = document.getElementById(targetId);
        if (!sec) return;

        // сохраняем прогресс текущей страницы
        saveCurrentProgress();

        sections.forEach(s => {
        if (s === sec) {
            s.classList.add("active");
            updatePageUI(s);
        } else {
            s.classList.remove("active");
        }
        });
    }

    // Вкладки
    tabs.forEach(tab => {
        tab.addEventListener("click", () => {
        const targetId = tab.dataset.section;

        tabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");

        activateSectionById(targetId);
        });
    });

    // "НАЗАД"
    pagePrev.addEventListener("click", () => {
        const activeSection = document.querySelector(".section-content.active");
        if (!activeSection) return;

        saveCurrentProgress();

        let pageIndex = parseInt(activeSection.dataset.pageIndex || "0", 10);
        pageIndex = Math.max(0, pageIndex - 1);
        activeSection.dataset.pageIndex = String(pageIndex);

        updatePageUI(activeSection);
    });

    // "ДАЛЕЕ"
    pageNext.addEventListener("click", () => {
        const activeSection = document.querySelector(".section-content.active");
        if (!activeSection) return;

        saveCurrentProgress();

        const pages = getPages(activeSection);
        let pageIndex = parseInt(activeSection.dataset.pageIndex || "0", 10);
        const totalPages = pages.length;

        pageIndex = Math.min(totalPages - 1, pageIndex + 1);
        activeSection.dataset.pageIndex = String(pageIndex);

        updatePageUI(activeSection);
    });

    // Инициализация: собираем страницы для всех секций
    sections.forEach(sec => {
        buildPagesForSection(sec);
    });

    // Старт: активная секция
    window.addEventListener("load", () => {
        const firstActive = document.querySelector(".section-content.active");
        if (firstActive) {
        updatePageUI(firstActive);
        }
    });
    </script>





</body>
</html>
